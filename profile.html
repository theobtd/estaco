<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <title>Estaco</title>
    <style>
        :root {
          --estaco-primary: #8B8E6F;
          --estaco-primary-light: #A7A98C;
          --estaco-secondary: #E2725B;
          --estaco-accent: #A8B8A8;
          --estaco-background: #FFFFFF;
          --estaco-surface: #F9F9F9;
          --estaco-text: #333333;
          --estaco-text-light: #666666;
          --estaco-border: #E0E0E0;
          --estaco-error: #F44336;
          --estaco-success: #4CAF50;
        }
    
        body {
          font-family: 'Inter', 'Roboto', 'Helvetica Neue', sans-serif;
          margin: 0;
          padding: 0;
          padding-top: 60px;
          padding-bottom: 60px;
          background-color: var(--estaco-background);
          color: var(--estaco-text);
          line-height: 1.5;
        }
    
        #top-nav-bar {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          display: flex;
          justify-content: center;
          align-items: center;
          background-color: var(--estaco-surface);
          border-bottom: 1px solid var(--estaco-border);
          padding: 12px 0;
          z-index: 100;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
    
        #top-nav-bar h1 {
          margin: 0;
          font-size: 20px;
          font-weight: 600;
          color: var(--estaco-primary);
          letter-spacing: 0.5px;
        }
    
        .profile-header {
          background: var(--estaco-surface);
          padding: 24px;
          margin-bottom: 16px;
          border-radius: 12px;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
          display: flex;
          flex-direction: column;
          align-items: center;
          text-align: center;
          border: 1px solid var(--estaco-border);
        }
    
        .profile-picture-container {
          margin-bottom: 16px;
          position: relative;
          width: 120px;
          height: 120px;
          border-radius: 15%;
          overflow: hidden;
          border: 3px solid var(--estaco-primary);
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .profile-picture-placeholder,
        .profile-picture {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          border-radius: 15%;
          object-fit: cover;
          display: block;
        }
        
        .profile-picture {
          display: none;
        }
    
        .profile-details {
          margin-bottom: 16px;
        }
    
        .profile-details h2 {
          margin: 0 0 4px 0;
          font-size: 22px;
          font-weight: 600;
          color: var(--estaco-text);
        }
    
        .profile-details p {
          margin: 0;
          color: var(--estaco-text-light);
          font-size: 14px;
        }
    
        .profile-actions {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 10px;
          margin-top: 8px;
        }
    
        .button {
          padding: 10px 20px;
          background-color: var(--estaco-primary);
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-size: 14px;
          font-weight: 500;
          transition: all 0.2s ease;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
    
        .button:hover {
          background-color: var(--estaco-primary-light);
          transform: translateY(-1px);
        }
    
        .button.remove {
          background-color: var(--estaco-error);
        }
    
        .button.remove:hover {
          background-color: #d32f2f;
        }
    
        .profile-content {
          background: var(--estaco-surface);
          padding: 20px;
          margin-bottom: 20px;
          border-radius: 12px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
          border: 1px solid var(--estaco-border);
        }
    
        .section {
          margin-bottom: 24px;
        }
    
        .section h3 {
          margin-top: 0;
          margin-bottom: 12px;
          font-size: 18px;
          font-weight: 600;
          color: var(--estaco-primary);
          border-bottom: 1px solid var(--estaco-border);
          padding-bottom: 8px;
        }
    
        .search-friend {
          display: flex;
          gap: 10px;
          margin-bottom: 20px;
        }
    
        .search-friend input {
          flex: 1;
          padding: 12px;
          border: 1px solid var(--estaco-border);
          border-radius: 8px;
          font-size: 14px;
          transition: border-color 0.2s;
        }
    
        .search-friend input:focus {
          outline: none;
          border-color: var(--estaco-primary);
        }
    
        .friend-list {
          display: flex;
          flex-direction: column;
          gap: 10px;
        }
    
        .friend, .pending-friend {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 12px 16px;
          background: white;
          border-radius: 8px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
          border: 1px solid var(--estaco-border);
          transition: transform 0.1s;
        }
    
        .friend:hover, .pending-friend:hover {
          transform: translateY(-2px);
        }
    
        .friend-button {
          padding: 6px 12px;
          background-color: var(--estaco-primary);
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
          font-size: 12px;
          transition: background-color 0.2s;
        }
    
        .friend-button:hover {
          background-color: var(--estaco-primary-light);
        }
    
        .friend-button.remove {
          background-color: var(--estaco-error);
        }
    
        .message {
          padding: 12px;
          margin: 12px 0;
          text-align: center;
          font-size: 14px;
        }
    
        #error-message {
          color: var(--estaco-error);
        }
    
        #success-message {
          color: var(--estaco-success);
        }
    
        #cropper-modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.8);
          z-index: 1000;
          align-items: center;
          justify-content: center;
        }
    
        #cropper-modal > div {
          max-width: 90%;
          width: 350px;
          margin: 0;
          background: white;
          padding: 20px;
          border-radius: 12px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    
        #cropper-modal h3 {
          margin-top: 0;
          color: var(--estaco-primary);
          font-size: 18px;
        }
    
        #crop-done-button, #crop-cancel-button {
          margin-top: 12px;
          width: 100%;
          padding: 10px;
        }
    
        #crop-cancel-button {
          background-color: var(--estaco-error);
          margin-top: 8px;
        }
    
        #bottom-nav-bar {
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          display: flex;
          justify-content: space-around;
          align-items: center;
          background-color: var(--estaco-surface);
          border-top: 1px solid var(--estaco-border);
          padding: 10px 0;
          z-index: 100;
          box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.05);
        }
    
        .nav-button {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          background: none;
          border: none;
          cursor: pointer;
          padding: 8px 16px;
          color: var(--estaco-text-light);
          font-size: 12px;
          transition: color 0.2s;
        }
    
        .nav-button.active, .nav-button:hover {
          color: var(--estaco-primary);
        }
    
        .nav-button .icon {
          font-size: 22px;
          margin-bottom: 4px;
        }
    
        .nav-button .label {
          font-size: 12px;
        }
        .rules-container {
          background: var(--estaco-surface);
          padding: 16px;
          border-radius: 8px;
          border: 1px solid var(--estaco-border);
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .rules-container p {
          margin: 8px 0;
          color: var(--estaco-text);
          font-size: 14px;
        }
        
        .rules-container .example {
          margin-top: 12px;
          padding: 12px;
          background: var(--estaco-accent);
          border-radius: 8px;
          border-left: 3px solid var(--estaco-primary);
        }
        
        .rules-container .example p {
          margin: 0;
          font-style: italic;
        }
    </style>

</head>
<body>
      <!-- Top Navigation Bar (optional, for consistency with home page) -->
      <div id="top-nav-bar">
        <h1>Estaco</h1>
      </div>

        <div id="download-app-section" style="margin: 20px auto; text-align: center; max-width: 400px;">
            <button id="download-app-button" style="
              background-color: var(--estaco-accent);
              color: var(--estaco-text);
              border: none;
              border-radius: 8px;
              padding: 12px;
              font-weight: 500;
              cursor: pointer;
              transition: background-color 0.3s;
              width: 100%;
            " data-i18n="Download the App">
              Download the App
            </button>
            <div id="install-guide" style="display: none; margin-top: 20px; text-align: left; background-color: var(--estaco-surface); padding: 20px; border-radius: 12px;">
              <h3 style="color: var(--estaco-primary;" data-i18n="How to Install the App">How to Install the App</h3>
              <p data-i18n="Android"><strong data-i18n="Android">Android:</strong></p>
              <ol>
                <li data-i18n="Android step 1">Tap the <strong>three dots (‚ãÆ)</strong> in the top-right corner of your browser.</li>
                <li data-i18n="Android step 2">Select <strong>"Add to Home screen"</strong>.</li>
                <li data-i18n="Android step 3">Tap <strong>"Add"</strong> to confirm.</li>
              </ol>
              <p data-i18n="iPhone (iOS)"><strong data-i18n="iPhone (iOS)">iPhone (iOS):</strong></p>
              <ol>
                <li data-i18n="iPhone step 1">Tap the <strong>Share button (‚Üë)</strong> at the bottom of your screen.</li>
                <li data-i18n="iPhone step 2">Scroll down and select <strong>"Add to Home Screen"</strong>.</li>
                <li data-i18n="iPhone step 3">Tap <strong>"Add"</strong> to confirm.</li>
              </ol>
              <p style="font-size: 14px; color: var(--estaco-text-light);" data-i18n="App installed message">The app will now appear on your home screen like a normal app!</p>
            </div>
        </div>

    
      <!-- Profile Header -->
      <div class="profile-header">
        <div class="profile-picture-container">
          <div id="profile-picture-placeholder" class="profile-picture-placeholder"></div>
          <img id="profile-picture" src="" alt="Profile Picture" class="profile-picture">
        </div>
        <div class="profile-details">
          <h2 id="user-name">User Name</h2>
          <p id="user-email">user@example.com</p>
        </div>
        <div class="profile-actions">
          <button id="update-profile-pic-button" class="button" data-i18n="Update Profile Picture">Update Profile Picture</button>
          <button id="change-password-button" class="button" data-i18n="Change Password">Change Password</button>
          <button id="logout-button" class="button" data-i18n="Log Out">Log Out</button>
        </div>
      </div>
    
        <div class="section">
          <h3 data-i18n="Platform Rules">Platform Rules</h3>
          <div class="rules-container">
            <p data-i18n="Max 15 friends"><strong>1.</strong> Max 15 friends.</p>
            <p data-i18n="Posts visibility"><strong>2.</strong> Your posts are not visible to users who are not your friends.</p>
            <p data-i18n="Comments visibility"><strong>3.</strong> Your comments and reactions are not visible to users who are not your friends.</p>
            <div class="example">
              <p data-i18n="Visibility example"><strong>Example:</strong> John is friends with Mike but not with Jenny. Mike is friends with Jenny. If Jenny comments on Mike's post, John will see Mike's post but not Jenny's comment.</p>
            </div>
          </div>
        </div>
    
      <!-- Profile Content -->
      <div class="profile-content">
        <div class="section">
          <h3 data-i18n="Friend System">Friend System</h3>
          <div class="search-friend">
            <input type="text" id="search-friend" placeholder="Search by name..." data-i18n="Search by name...">
            <button id="send-friend-request" class="button" data-i18n="Send Friend Request">Send Friend Request</button>
          </div>
        </div>
        
        <div class="section">
          <h3 data-i18n="Pending Friend Requests">Pending Friend Requests</h3>
          <div id="pending-friend-requests" class="friend-list"></div>
        </div>
        
        <div class="section">
          <h3 data-i18n="Current Friends">Current Friends</h3>
          <div id="current-friends" class="friend-list"></div>
        </div>
    
      <!-- Cropper Modal -->
        <div id="cropper-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
          <div style="max-width: 500px; margin: 20px auto; background: white; padding: 20px; border-radius: 10px;">
            <h3 data-i18n="Crop Profile Picture">Crop Profile Picture</h3>
            <div style="width: 100%; height: 400px;">
              <img id="cropper-image" style="max-width: 100%;">
            </div>
            <button id="crop-done-button" class="button" style="margin-top: 10px;" data-i18n="Crop and Upload">Crop and Upload</button>
            <button id="crop-cancel-button" class="button" style="margin-top: 10px; background-color: #f44336;" data-i18n="Cancel">Cancel</button>
          </div>
        </div>
    
      <input type="file" id="update-profile-pic" accept="image/*" style="display: none;">
      <p id="error-message" class="message"></p>
      <p id="success-message" class="message"></p>

        <div id="bottom-nav-bar">
          <button class="nav-button" id="home-button">
            <span class="icon">üè†</span>
            <span class="label" data-i18n="Feed">Feed</span>
          </button>
          <button class="nav-button" id="notifications-button">
              <span class="icon">üîî</span>
              <span class="label">Notifications</span>
            </button>
          <button class="nav-button" id="profile-button">
            <span class="icon">üë§</span>
            <span class="label" data-i18n="Profile">Profile</span>
          </button>
        </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script>
        // Your Firebase config (replace with your own)
        const firebaseConfig = {
            apiKey: "AIzaSyB1txjASKb_6VPhKBpQh_Y3hoPHsNWwZ_0",
            authDomain: "estaco-add3c.firebaseapp.com",
            projectId: "estaco-add3c",
            storageBucket: "estaco-add3c.firebasestorage.app",
            messagingSenderId: "876337002297",
            appId: "1:876337002297:web:b410c373bd857bc7cd1ae8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const storage = firebase.storage();
        const db = firebase.firestore();

        let userLanguage = "English"; // Define globally

        // DOM Elements
        const searchFriendInput = document.getElementById('search-friend');
        const sendFriendRequestButton = document.getElementById('send-friend-request');
        const pendingFriendRequestsDiv = document.getElementById('pending-friend-requests');
        const currentFriendsDiv = document.getElementById('current-friends');

        // Load friends and requests on page load
        auth.onAuthStateChanged(user => {
            if (user) {
                loadPendingRequests(user.uid);
                loadCurrentFriends(user.uid);
            }
        });

        // Load pending friend requests
        function loadPendingRequests(userId) {
            db.collection('friendRequests').where('to', '==', userId).get()
                .then(snapshot => {
                    pendingFriendRequestsDiv.innerHTML = '';
                    const promises = [];
                    snapshot.forEach(doc => {
                        const request = doc.data();
                        const promise = db.collection('users').doc(request.from).get()
                            .then(userDoc => {
                                const fromName = userDoc.data().name;
                                const requestDiv = document.createElement('div');
                                requestDiv.className = 'pending-friend';
                                requestDiv.innerText = fromName;
                                const acceptButton = document.createElement('button');
                                acceptButton.className = 'friend-button';
                                acceptButton.innerText = 'Accept';
                                acceptButton.onclick = () => acceptFriendRequest(request.from, userId);
                                requestDiv.appendChild(acceptButton);
                                pendingFriendRequestsDiv.appendChild(requestDiv);
                            });
                        promises.push(promise);
                    });
                    return Promise.all(promises);
                });
        }

        // Load current friends
        function loadCurrentFriends(userId) {
            db.collection('friends').doc(userId).get()
                .then(doc => {
                    const friends = doc.data()?.friends || [];
                    currentFriendsDiv.innerHTML = '';
                    friends.forEach(friend => {
                        const friendDiv = document.createElement('div');
                        friendDiv.className = 'friend';
                        friendDiv.innerText = friend.name;
                        // Add a "Remove" button
                        const removeButton = document.createElement('button');
                        removeButton.className = 'friend-button remove';
                        removeButton.innerText = 'Remove';
                        removeButton.onclick = () => removeFriend(userId, friend.uid);
                        friendDiv.appendChild(removeButton);
                        currentFriendsDiv.appendChild(friendDiv);
                    });
                });
        }

        // Send friend request
        sendFriendRequestButton.addEventListener('click', () => {
            const friendName = searchFriendInput.value.trim();
            if (friendName) {
                const user = auth.currentUser;
                if (!user) return;
        
                // Check if the user already has 15 friends
                db.collection('friends').doc(user.uid).get()
                    .then((doc) => {
                        const friends = doc.data()?.friends || [];
                        if (friends.length >= 15) {
                            alert(translations[userLanguage]["You have reached the maximum number of friends (15)."]);
                            return;
                        }
        
                        // Proceed with sending the friend request
                        db.collection('users').where('name', '==', friendName).get()
                            .then(snapshot => {
                                if (!snapshot.empty) {
                                    const friendDoc = snapshot.docs[0];
                                    const friendUser = friendDoc.data();
                                    const friendUid = friendDoc.id;
                                    sendRequest(user.uid, friendUid, friendUser.name);
                                } else {
                                    alert(translations[userLanguage]["User not found"]);
                                }
                            })
                            .catch(error => {
                                console.error('Error searching for user: ', error);
                                alert(translations[userLanguage]["An error occurred while searching for the user."]);
                            });
                    });
            } else {
                alert(translations[userLanguage]["Please enter a name to search"]);
            }
        });

        // Function to send friend request
        function sendRequest(fromId, toId, fromName) {
            if (!toId) {
                console.error('Cannot send friend request: toId is undefined.');
                return;
            }
            db.collection('friendRequests').add({
                from: fromId,
                to: toId,
                fromName: fromName,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                alert(translations[userLanguage]["Friend request sent!"]);
            }).catch(error => {
                console.error('Error sending friend request: ', error);
                alert(translations[userLanguage]["Failed to send friend request."]);
            });
        }

        // Accept friend request
        function acceptFriendRequest(fromId, toId) {
            // Check if the user already has 15 friends
            db.collection('friends').doc(toId).get()
                .then((doc) => {
                    const friends = doc.data()?.friends || [];
                    if (friends.length >= 15) {
                        alert('You have reached the maximum number of friends (15).');
                        return;
                    }
        
                    // Proceed with accepting the friend request
                    db.collection('users').doc(fromId).get()
                        .then(fromUserDoc => {
                            const fromName = fromUserDoc.data().name;
                            db.collection('users').doc(toId).get()
                                .then(toUserDoc => {
                                    const toName = toUserDoc.data().name;
                                    db.collection('friends').doc(toId).set({
                                        friends: firebase.firestore.FieldValue.arrayUnion({ uid: fromId, name: fromName }),
                                        friendsList: firebase.firestore.FieldValue.arrayUnion(fromId)
                                    }, { merge: true });
                                    db.collection('friends').doc(fromId).set({
                                        friends: firebase.firestore.FieldValue.arrayUnion({ uid: toId, name: toName }),
                                        friendsList: firebase.firestore.FieldValue.arrayUnion(toId)
                                    }, { merge: true });
                                    db.collection('friendRequests').where('from', '==', fromId).where('to', '==', toId).get()
                                        .then(snapshot => {
                                            snapshot.forEach(doc => {
                                                doc.ref.delete();
                                            });
                                            const pendingRequests = document.querySelectorAll('.pending-friend');
                                            pendingRequests.forEach(requestDiv => {
                                                if (requestDiv.textContent.includes(fromName)) {
                                                    requestDiv.remove();
                                                }
                                            });
                                            alert(translations[userLanguage]["Friend request accepted!"]);
        
                                            // Update feeds for both users
                                            updateFeedsAfterFriendship(toId, fromId)
                                                .then(() => {
                                                    loadCurrentFriends(toId);
                                                })
                                                .catch(error => {
                                                    console.error('Error updating feeds:', error);
                                                });
                                        });
                                });
                        });
                });
        }

        function removeFriend(userId, friendUid) {
          const confirmRemove = confirm(translations[userLanguage]["Are you sure you want to remove this friend?"]);
          if (!confirmRemove) return;
        
          Promise.all([
            db.collection('users').doc(friendUid).get(),
            db.collection('users').doc(userId).get()
          ])
          .then(([friendDoc, userDoc]) => {
            if (friendDoc.exists && userDoc.exists) {
              const friendName = friendDoc.data().name;
              const userName = userDoc.data().name;
        
              const userFriendsUpdate = db.collection('friends').doc(userId).update({
                friends: firebase.firestore.FieldValue.arrayRemove({ uid: friendUid, name: friendName }),
                friendsList: firebase.firestore.FieldValue.arrayRemove(friendUid)
              });
        
              const friendFriendsUpdate = db.collection('friends').doc(friendUid).update({
                friends: firebase.firestore.FieldValue.arrayRemove({ uid: userId, name: userName }),
                friendsList: firebase.firestore.FieldValue.arrayRemove(userId)
              });
        
              Promise.all([userFriendsUpdate, friendFriendsUpdate])
                .then(() => {
                  // Remove feed entries for both users
                  removeFeedsAfterUnfriend(userId, friendUid)
                    .then(() => {
                      loadCurrentFriends(userId);
                    })
                    .catch((error) => {
                      console.error("Error cleaning up feeds:", error);
                    });
                })
                .catch((error) => {
                  console.error("Error updating friends lists: ", error);
                  alert(translations[userLanguage]["Failed to update friends lists."]);
                });
            } else {
              console.error("User or friend document does not exist.");
              alert(translations[userLanguage]["Failed to remove friend."]);
            }
          })
          .catch((error) => {
            console.error("Error fetching user or friend data: ", error);
            alert("Failed to remove friend.");
          });
        }

        // Display user information
        auth.onAuthStateChanged((user) => {
          if (user) {
            document.getElementById('user-name').textContent = user.displayName || "No name set";
            document.getElementById('user-email').textContent = user.email;
        
            const placeholder = document.getElementById('profile-picture-placeholder');
            const img = document.getElementById('profile-picture');
            placeholder.innerHTML = getInitialsFallback(user.displayName || "No name set");
            placeholder.style.display = 'block';
            img.style.display = 'none';
        
            db.collection('users').doc(user.uid).get()
              .then((doc) => {
                if (doc.exists) {
                  const userData = doc.data();
                  userLanguage = userData.language || "English";
                  updatePageLanguage(userLanguage);
                  if (userData.profilePictureURL) {
                    img.src = userData.profilePictureURL;
                    img.onload = () => {
                      img.style.display = 'block';
                      placeholder.style.display = 'none';
                    };
                  }
                }
              })
              .catch((error) => {
                console.error("Error loading user data:", error);
              });
          }
        });
        
        // Upload profile picture
        document.getElementById('update-profile-pic-button').addEventListener('click', () => {
          const fileInput = document.getElementById('update-profile-pic');
          fileInput.click();
        });
        
        let cropper;
        document.getElementById('update-profile-pic').addEventListener('change', (event) => {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              const modal = document.getElementById('cropper-modal');
              const cropperImage = document.getElementById('cropper-image');
              cropperImage.src = e.target.result;
              modal.style.display = 'block';
        
              // Initialize Cropper.js
              cropper = new Cropper(cropperImage, {
                aspectRatio: 1, // Square aspect ratio
                viewMode: 1,
                dragMode: 'move',
                guides: true,
                highlight: false,
                cropBoxMovable: true,
                cropBoxResizable: true,
                modal: true,
              });
            };
            reader.readAsDataURL(file);
          }
        });

        function getInitialsFallback(name) {
          const firstLetter = name.charAt(0).toUpperCase();
          const pastelColors = ['#FFD1DC', '#FFE4B5', '#B5EAD7', '#C7CEEA', '#E2F0CB', '#FFB7B2'];
          const colorIndex = name.charCodeAt(0) % pastelColors.length;
          const backgroundColor = pastelColors[colorIndex];
          return `
            <div style="
              width: 120px;
              height: 120px;
              border-radius: 15%;
              background-color: ${backgroundColor};
              display: flex;
              align-items: center;
              justify-content: center;
              color: #333;
              font-weight: bold;
              font-size: 40px;
            ">
              ${firstLetter}
            </div>
          `;
        }
        
        // Handle crop done
        document.getElementById('crop-done-button').addEventListener('click', () => {
          if (cropper) {
            const canvas = cropper.getCroppedCanvas({
              width: 200,
              height: 200,
              fillColor: '#fff',
              imageSmoothingEnabled: true,
              imageSmoothingQuality: 'high',
            });
            if (canvas) {
              canvas.toBlob((blob) => {
                const user = auth.currentUser;
                const storageRef = storage.ref();
                const profilePicRef = storageRef.child(`profilePictures/${user.uid}`);
                const uploadTask = profilePicRef.put(blob);
        
                uploadTask.on('state_changed',
                  null,
                  (error) => {
                    console.error('Upload error:', error);
                    document.getElementById('error-message').textContent = translations[userLanguage]["Failed to upload profile picture."];
                  },
                  () => {
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                      db.collection('users').doc(user.uid).update({
                        profilePictureURL: downloadURL
                      }).then(() => {
                        document.getElementById('profile-picture').src = downloadURL;
                        document.getElementById('success-message').textContent = translations[userLanguage]["Profile picture updated!"];
                        document.getElementById('cropper-modal').style.display = 'none';
                        cropper.destroy();
                      });
                    });
                  }
                );
              }, 'image/jpeg');
            }
          }
        });

        /**
         * Fetches all post UIDs for a given user.
         * @param {string} userId - The user's UID.
         * @returns {Promise<string[]>} - Array of post UIDs.
         */
        async function getPostUidsForUser(userId) {
          try {
            const postsSnapshot = await db.collection('posts')
              .where('authorId', '==', userId)
              .get();
            return postsSnapshot.docs.map(doc => doc.id);
          } catch (error) {
            console.error('Error fetching post UIDs:', error);
            return [];
          }
        }

        /**
         * Removes all feed entries for both users when a friendship is ended.
         * @param {string} userId1 - The first user's UID.
         * @param {string} userId2 - The second user's UID.
         */
        async function removeFeedsAfterUnfriend(userId1, userId2) {
          try {
            // 1. Fetch all post UIDs for userId2 (the friend being removed)
            const postUids = await getPostUidsForUser(userId2);
        
            // 2. Delete all posts from userId2 in userId1's feed
            if (postUids.length > 0) {
              const batch = db.batch();
              postUids.forEach(postUid => {
                const feedRef = db.collection(`users/${userId1}/feed`).doc(postUid);
                batch.delete(feedRef);
              });
              await batch.commit();
            }
        
            // 3. Fetch all post UIDs for userId1
            const userPostUids = await getPostUidsForUser(userId1);
        
            // 4. Delete all posts from userId1 in userId2's feed
            if (userPostUids.length > 0) {
              const batch = db.batch();
              userPostUids.forEach(postUid => {
                const feedRef = db.collection(`users/${userId2}/feed`).doc(postUid);
                batch.delete(feedRef);
              });
              await batch.commit();
            }
        
            console.log('Feeds cleaned up after unfriend');
          } catch (error) {
            console.error('Error cleaning up feeds after unfriend:', error);
          }
        }

        /**
         * Updates the feed sub-collections for both users when they become friends.
         * @param {string} userId1 - The first user's UID.
         * @param {string} userId2 - The second user's UID.
         */
        async function updateFeedsAfterFriendship(userId1, userId2) {
          try {
            // 1. Fetch all posts from userId2 (new friend) for userId1's feed
            const postsSnapshot = await db.collection('posts')
              .where('authorId', '==', userId2)
              .orderBy('timestamp', 'desc')
              .get();
        
            if (!postsSnapshot.empty) {
              const batch = db.batch();
              postsSnapshot.forEach((postDoc) => {
                const post = postDoc.data();
                // Add to userId1's feed
                const feedRef1 = db.collection(`users/${userId1}/feed`).doc(postDoc.id);
                batch.set(feedRef1, {
                  postId: postDoc.id,
                  postTimestamp: post.timestamp,
                });
              });
              await batch.commit();
            }
        
            // 2. Fetch all posts from userId1 for userId2's feed
            const userPostsSnapshot = await db.collection('posts')
              .where('authorId', '==', userId1)
              .orderBy('timestamp', 'desc')
              .get();
        
            if (!userPostsSnapshot.empty) {
              const batch = db.batch();
              userPostsSnapshot.forEach((postDoc) => {
                const post = postDoc.data();
                // Add to userId2's feed
                const feedRef = db.collection(`users/${userId2}/feed`).doc(postDoc.id);
                batch.set(feedRef, {
                  postId: postDoc.id,
                  postTimestamp: post.timestamp,
                });
              });
              await batch.commit();
            }
        
            console.log('Feeds updated for new friendship');
          } catch (error) {
            console.error('Error updating feeds after friendship:', error);
          }
        }
        
        // Handle cancel
        document.getElementById('crop-cancel-button').addEventListener('click', () => {
          document.getElementById('cropper-modal').style.display = 'none';
          if (cropper) {
            cropper.destroy();
          }
        });

        // Change Password
        document.getElementById('change-password-button').addEventListener('click', () => {
            const currentPassword = prompt(translations[userLanguage]["Enter your current password:"]);
            if (currentPassword) {
                const user = auth.currentUser;
                const credential = firebase.auth.EmailAuthProvider.credential(user.email, currentPassword);
                user.reauthenticateWithCredential(credential).then(() => {
                    const newPassword = prompt(translations[userLanguage]["Enter your new password (at least 6 characters):"]);
                    const confirmPassword = prompt(translations[userLanguage]["Confirm your new password:"]);

                    if (newPassword && confirmPassword && newPassword === confirmPassword && newPassword.length >= 6) {
                        user.updatePassword(newPassword).then(() => {
                            document.getElementById('success-message').textContent = translations[userLanguage]["Password updated successfully!"];
                            document.getElementById('error-message').textContent = '';
                        }).catch((error) => {
                            document.getElementById('error-message').textContent = error.message;
                            document.getElementById('success-message').textContent = '';
                        });
                    } else {
                        alert('Passwords do not match or are too short. Please try again.');
                    }
                }).catch((error) => {
                    document.getElementById('error-message').textContent = 'Current password is incorrect.';
                    document.getElementById('success-message').textContent = '';
                });
            }
        });

        // Log Out
        document.getElementById('logout-button').addEventListener('click', () => {
          const confirmLogout = confirm(translations[userLanguage]["Are you sure you want to log out?"]);
          if (confirmLogout) {
            auth.signOut().then(() => {
              alert(translations[userLanguage]["You have been logged out."]);
              window.location.href = 'index.html';
            }).catch((error) => {
              document.getElementById('error-message').textContent = error.message;
            });
          }
        });

        // Navigate to Home
        document.getElementById('home-button').addEventListener('click', () => {
          window.location.href = 'home.html';
        });

        document.getElementById('notifications-button').addEventListener('click', () => {
          window.location.href = 'notifications.html';
        });
        
        // Navigate to Profile (optional, since you're already on the profile page)
        document.getElementById('profile-button').addEventListener('click', () => {
          window.location.href = 'profile.html';
        });

        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
              .then((registration) => {
                console.log('ServiceWorker registration successful');
                // Force update check
                registration.update();
              })
              .catch((err) => {
                console.log('ServiceWorker registration failed: ', err);
              });
          });
        }

        const downloadAppButton = document.getElementById('download-app-button');
        const installGuide = document.getElementById('install-guide');
        
        downloadAppButton.addEventListener('click', () => {
          if (installGuide.style.display === 'none') {
            installGuide.style.display = 'block';
            downloadAppButton.textContent = translations[userLanguage]["Hide Guide"];
          } else {
            installGuide.style.display = 'none';
            downloadAppButton.textContent = translations[userLanguage]["Download the App"];
          }
        });

        const translations = {
          English: {
            "Download the App": "Download the App",
            "How to Install the App": "How to Install the App",
            "Android": "Android:",
            "Android step 1": "Tap the three dots (‚ãÆ) in the top-right corner of your browser.",
            "Android step 2": "Select \"Add to Home screen\".",
            "Android step 3": "Tap \"Add\" to confirm.",
            "iPhone (iOS)": "iPhone (iOS):",
            "iPhone step 1": "Tap the Share button (‚Üë) at the bottom of your screen.",
            "iPhone step 2": "Scroll down and select \"Add to Home Screen\".",
            "iPhone step 3": "Tap \"Add\" to confirm.",
            "App installed message": "The app will now appear on your home screen like a normal app!",
            "Platform Rules": "Platform Rules",
            "Max 15 friends": "Max 15 friends.",
            "Posts visibility": "Your posts are not visible to users who are not your friends.",
            "Comments visibility": "Your comments and reactions are not visible to users who are not your friends.",
            "Visibility example": "John is friends with Mike but not with Jenny. Mike is friends with Jenny. If Jenny comments on Mike's post, John will see Mike's post but not Jenny's comment.",
            "Friend System": "Friend System",
            "Search by name...": "Search by name...",
            "Send Friend Request": "Send Friend Request",
            "Pending Friend Requests": "Pending Friend Requests",
            "Current Friends": "Current Friends",
            "Update Profile Picture": "Update Profile Picture",
            "Change Password": "Change Password",
            "Log Out": "Log Out",
            "Crop Profile Picture": "Crop Profile Picture",
            "Crop and Upload": "Crop and Upload",
            "Cancel": "Cancel",
            "Failed to upload profile picture.": "Failed to upload profile picture.",
            "Profile picture updated!": "Profile picture updated!",
            "Feed": "Feed",
            "Profile": "Profile",
            "Enter your current password:": "Enter your current password:",
            "Enter your new password (at least 6 characters):": "Enter your new password (at least 6 characters):",
            "Confirm your new password:": "Confirm your new password:",
            "Passwords do not match or are too short. Please try again.": "Passwords do not match or are too short. Please try again.",
            "Current password is incorrect.": "Current password is incorrect.",
            "You have been logged out.": "You have been logged out.",
            "User not found": "User not found",
            "Friend request sent!": "Friend request sent!",
            "Friend request accepted!": "Friend request accepted!",
            "Failed to send friend request.": "Failed to send friend request.",
            "Failed to update friends lists.": "Failed to update friends lists.",
            "Failed to remove friend.": "Failed to remove friend: user or friend not found.",
            "Are you sure you want to remove this friend?": "Are you sure you want to remove this friend?",
            "Are you sure you want to log out?": "Are you sure you want to log out?",
            "Please enter a name to search": "Please enter a name to search",
            "Hide Guide": "Hide Guide",
            "An error occurred while searching for the user.": "An error occurred while searching for the user.",
              // ... rest of your translations
          },
          French: {
            "Download the App": "T√©l√©charger l'application",
            "How to Install the App": "Comment installer l'application",
            "Android": "Android :",
            "Android step 1": "Appuyez sur les trois points (‚ãÆ) dans le coin sup√©rieur droit de votre navigateur.",
            "Android step 2": "S√©lectionnez \"Ajouter √† l'√©cran d'accueil\".",
            "Android step 3": "Appuyez sur \"Ajouter\" pour confirmer.",
            "iPhone (iOS)": "iPhone (iOS) :",
            "iPhone step 1": "Appuyez sur le bouton Partager (‚Üë) en bas de votre √©cran.",
            "iPhone step 2": "Faites d√©filer vers le bas et s√©lectionnez \"Ajouter √† l'√©cran d'accueil\".",
            "iPhone step 3": "Appuyez sur \"Ajouter\" pour confirmer.",
            "App installed message": "L'application appara√Ætra d√©sormais sur votre √©cran d'accueil comme une application normale !",
            "Platform Rules": "R√®gles de la plateforme",
            "Max 15 friends": "Maximum 15 amis.",
            "Posts visibility": "Vos publications ne sont pas visibles pour les utilisateurs qui ne sont pas vos amis.",
            "Comments visibility": "Vos commentaires et r√©actions ne sont pas visibles pour les utilisateurs qui ne sont pas vos amis.",
            "Visibility example": "John est ami avec Mike mais pas avec Jenny. Mike est ami avec Jenny. Si Jenny commente la publication de Mike, John verra la publication de Mike mais pas le commentaire de Jenny.",
            "Friend System": "Syst√®me d'amis",
            "Search by name...": "Rechercher par nom...",
            "Send Friend Request": "Envoyer une demande d'ami",
            "Pending Friend Requests": "Demandes d'ami en attente",
            "Current Friends": "Amis actuels",
            "Update Profile Picture": "Mettre √† jour la photo de profil",
            "Change Password": "Changer le mot de passe",
            "Log Out": "Se d√©connecter",
            "Crop Profile Picture": "Recadrer la photo de profil",
            "Crop and Upload": "Recadrer et t√©l√©charger",
            "Cancel": "Annuler",
            "Failed to upload profile picture.": "√âchec du t√©l√©chargement de la photo de profil.",
            "Profile picture updated!": "Photo de profil mise √† jour !",
            "Feed": "Fil d'actualit√©",
            "Profile": "Profil",
            "Enter your current password:": "Entrez votre mot de passe actuel :",
            "Enter your new password (at least 6 characters):": "Entrez votre nouveau mot de passe (au moins 6 caract√®res) :",
            "Confirm your new password:": "Confirmez votre nouveau mot de passe :",
            "Passwords do not match or are too short. Please try again.": "Les mots de passe ne correspondent pas ou sont trop courts. Veuillez r√©essayer.",
            "Current password is incorrect.": "Le mot de passe actuel est incorrect.",
            "You have been logged out.": "Vous avez √©t√© d√©connect√©.",
            "User not found": "Utilisateur introuvable",
            "Friend request sent!": "Demande d'ami envoy√©e !",
            "Friend request accepted!": "Demande d'ami accept√©e !",
            "Failed to send friend request.": "√âchec de l'envoi de la demande d'ami.",
            "Failed to update friends lists.": "√âchec de la mise √† jour des listes d'amis.",
            "Failed to remove friend.": "√âchec de la suppression de l'ami : utilisateur ou ami introuvable.",
            "Are you sure you want to remove this friend?": "√ätes-vous s√ªr de vouloir retirer cet ami ?",
            "Are you sure you want to log out?": "√ätes-vous s√ªr de vouloir vous d√©connecter ?",
            "Please enter a name to search": "Veuillez entrer un nom √† rechercher",
            "Hide Guide": "Masquer le guide",
            "An error occurred while searching for the user.": "Une erreur s'est produite lors de la recherche de l'utilisateur.",
              // ... rest of your translations
          },
          Korean: {
            "Download the App": "Ïï± Îã§Ïö¥Î°úÎìú",
            "How to Install the App": "Ïï± ÏÑ§Ïπò Î∞©Î≤ï",
            "Android": "ÏïàÎìúÎ°úÏù¥Îìú:",
            "Android step 1": "Î∏åÎùºÏö∞Ï†Ä Ïò§Î•∏Ï™Ω ÏÉÅÎã® Î™®ÏÑúÎ¶¨Ïóê ÏûàÎäî ÏÑ∏ Ï†ê(‚ãÆ)ÏùÑ ÌÉ≠ÌïòÏÑ∏Ïöî.",
            "Android step 2": "\"Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä\"Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",
            "Android step 3": "\"Ï∂îÍ∞Ä\"Î•º ÌÉ≠ÌïòÏó¨ ÌôïÏù∏ÌïòÏÑ∏Ïöî.",
            "iPhone (iOS)": "ÏïÑÏù¥Ìè∞ (iOS):",
            "iPhone step 1": "ÌôîÎ©¥ ÌïòÎã®Ïóê ÏûàÎäî Í≥µÏú† Î≤ÑÌäº(‚Üë)ÏùÑ ÌÉ≠ÌïòÏÑ∏Ïöî.",
            "iPhone step 2": "ÏïÑÎûòÎ°ú Ïä§ÌÅ¨Î°§ÌïòÏó¨ \"Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä\"Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",
            "iPhone step 3": "\"Ï∂îÍ∞Ä\"Î•º ÌÉ≠ÌïòÏó¨ ÌôïÏù∏ÌïòÏÑ∏Ïöî.",
            "App installed message": "Ïù¥Ï†ú Ïï±Ïù¥ ÏùºÎ∞ò Ïï±Ï≤òÎüº Ìôà ÌôîÎ©¥Ïóê ÌëúÏãúÎê©ÎãàÎã§!",
            "Platform Rules": "ÌîåÎû´Ìèº Í∑úÏπô",
            "Max 15 friends": "ÏµúÎåÄ 15Î™ÖÏùò ÏπúÍµ¨.",
            "Posts visibility": "ÏπúÍµ¨Í∞Ä ÏïÑÎãå ÏÇ¨Ïö©ÏûêÏóêÍ≤åÎäî ÎãπÏã†Ïùò Í≤åÏãúÎ¨ºÏù¥ Î≥¥Ïù¥ÏßÄ ÏïäÏäµÎãàÎã§.",
            "Comments visibility": "ÏπúÍµ¨Í∞Ä ÏïÑÎãå ÏÇ¨Ïö©ÏûêÏóêÍ≤åÎäî ÎãπÏã†Ïùò ÎåìÍ∏ÄÍ≥º Î∞òÏùëÏù¥ Î≥¥Ïù¥ÏßÄ ÏïäÏäµÎãàÎã§.",
            "Visibility example": "Ï°¥ÏùÄ ÎßàÏù¥ÌÅ¨ÏôÄ ÏπúÍµ¨ÏßÄÎßå Ï†úÎãàÏôÄÎäî ÏπúÍµ¨Í∞Ä ÏïÑÎãôÎãàÎã§. ÎßàÏù¥ÌÅ¨Îäî Ï†úÎãàÏôÄ ÏπúÍµ¨ÏûÖÎãàÎã§. Ï†úÎãàÍ∞Ä ÎßàÏù¥ÌÅ¨Ïùò Í≤åÏãúÎ¨ºÏóê ÎåìÍ∏ÄÏùÑ Îã¨Î©¥, Ï°¥ÏùÄ ÎßàÏù¥ÌÅ¨Ïùò Í≤åÏãúÎ¨ºÏùÄ Î≥¥ÏßÄÎßå Ï†úÎãàÏùò ÎåìÍ∏ÄÏùÄ Î≥¥ÏßÄ Î™ªÌï©ÎãàÎã§.",
            "Friend System": "ÏπúÍµ¨ ÏãúÏä§ÌÖú",
            "Search by name...": "Ïù¥Î¶ÑÏúºÎ°ú Í≤ÄÏÉâ...",
            "Send Friend Request": "ÏπúÍµ¨ ÏöîÏ≤≠ Î≥¥ÎÇ¥Í∏∞",
            "Pending Friend Requests": "ÎåÄÍ∏∞ Ï§ëÏù∏ ÏπúÍµ¨ ÏöîÏ≤≠",
            "Current Friends": "ÌòÑÏû¨ ÏπúÍµ¨",
            "Update Profile Picture": "ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑ ÏóÖÎç∞Ïù¥Ìä∏",
            "Change Password": "ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω",
            "Log Out": "Î°úÍ∑∏ÏïÑÏõÉ",
            "Crop Profile Picture": "ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑ ÏûêÎ•¥Í∏∞",
            "Crop and Upload": "ÏûêÎ•¥Í≥† ÏóÖÎ°úÎìú",
            "Cancel": "Ï∑®ÏÜå",
            "Failed to upload profile picture.": "ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑ ÏóÖÎ°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.",
            "Profile picture updated!": "ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑÏù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§!",
            "Feed": "ÌîºÎìú",
            "Profile": "ÌîÑÎ°úÌïÑ",
            "Enter your current password:": "ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:",
            "Enter your new password (at least 6 characters):": "ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏(ÏµúÏÜå 6Ïûê Ïù¥ÏÉÅ)Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:",
            "Confirm your new password:": "ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî:",
            "Passwords do not match or are too short. Please try again.": "ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÍ±∞ÎÇò ÎÑàÎ¨¥ ÏßßÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥ Ï£ºÏÑ∏Ïöî.",
            "Current password is incorrect.": "ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.",
            "You have been logged out.": "Î°úÍ∑∏ÏïÑÏõÉÎêòÏóàÏäµÎãàÎã§.",
            "User not found": "ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå",
            "Friend request sent!": "ÏπúÍµ¨ ÏöîÏ≤≠Ïù¥ Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§!",
            "Friend request accepted!": "ÏπúÍµ¨ ÏöîÏ≤≠Ïù¥ ÏàòÎùΩÎêòÏóàÏäµÎãàÎã§!",
            "Failed to send friend request.": "ÏπúÍµ¨ ÏöîÏ≤≠ Ï†ÑÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.",
            "Failed to update friends lists.": "ÏπúÍµ¨ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.",
            "Failed to remove friend.": "ÏπúÍµ¨ ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ÏÇ¨Ïö©Ïûê ÎòêÎäî ÏπúÍµ¨Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.",
            "Are you sure you want to remove this friend?": "Ïù¥ ÏπúÍµ¨Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?",
            "Are you sure you want to log out?": "Î°úÍ∑∏ÏïÑÏõÉÌïòÏãúÍ≤†ÏäµÎãàÍπå?",
            "Please enter a name to search": "Í≤ÄÏÉâÌï† Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî",
            "Hide Guide": "Í∞ÄÏù¥Îìú Ïà®Í∏∞Í∏∞",
            "An error occurred while searching for the user.": "ÏÇ¨Ïö©ÏûêÎ•º Í≤ÄÏÉâÌïòÎäî ÎèôÏïà Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.",
              // ... rest of your translations
          }
        };

        function updatePageLanguage(language) {
          const lang = translations[language] || translations["English"];
          document.querySelectorAll("[data-i18n]").forEach((element) => {
            const key = element.getAttribute("data-i18n");
            if (lang[key]) {
              element.textContent = lang[key];
            }
          });
        }
    </script>
</body>
</html>
