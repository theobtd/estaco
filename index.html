<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Estaco</title>
  <link rel="manifest" href="/manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --estaco-primary: #8B8E6F;
      --estaco-primary-light: #A7A98C;
      --estaco-secondary: #E2725B;
      --estaco-accent: #A8B8A8;
      --estaco-background: #FFFFFF;
      --estaco-surface: #F9F9F9;
      --estaco-text: #333333;
      --estaco-text-light: #666666;
      --estaco-border: #E0E0E0;
      --estaco-error: #F44336;
      --estaco-success: #4CAF50;
    }

    body {
      font-family: 'Inter', sans-serif;
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
      background-color: var(--estaco-background);
      color: var(--estaco-text);
    }

    h1 {
      color: var(--estaco-primary);
      font-weight: 600;
      margin-bottom: 30px;
    }

    button {
      background-color: var(--estaco-accent);
      color: var(--estaco-text);
      border: none;
      border-radius: 8px;
      padding: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:active {
      background-color: var(--estaco-primary);
    }

    #show-signup, #show-signin {
      width: 100%;
      margin: 10px 0;
    }

    #signup-form, #signin-form {
      background-color: var(--estaco-surface);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      margin-top: 20px;
    }

    .form-group {
      text-align: left;
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--estaco-text-light);
    }

    input {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--estaco-border);
      border-radius: 8px;
      box-sizing: border-box;
      font-family: inherit;
    }

    input:focus {
      outline: none;
      border-color: var(--estaco-primary);
    }

    #error-message {
      color: var(--estaco-error);
      font-size: 14px;
      margin-top: 10px;
      text-align: center;
    }
    .toggle-password {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      color: var(--estaco-text-light);
    }
    select {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--estaco-border);
      border-radius: 8px;
      box-sizing: border-box;
      font-family: inherit;
      background-color: var(--estaco-surface);
    }
  </style>
</head>
<body>
  <h1>Estaco</h1>

  <div style="margin-bottom: 20px;">
    <label for="language-select" style="margin-right: 10px; font-weight: 500; color: var(--estaco-text-light);">Language:</label>
    <select id="language-select" style="
      padding: 8px;
      border: 1px solid var(--estaco-border);
      border-radius: 8px;
      background-color: var(--estaco-surface);
      font-family: inherit;
    ">
      <option value="English" selected>English</option>
      <option value="French">FranÃ§ais</option>
      <option value="Korean">í•œêµ­ì–´</option>
    </select>
  </div>
  
  <button id="show-signup" data-i18n="Create Account">Create Account</button>
  <button id="show-signin" data-i18n="Sign In">Sign In</button>

  <!-- Sign Up Form -->
  <div id="signup-form" style="display: none;">
    <h2 data-i18n="Create Account">Create Account</h2>
    <div class="form-group">
      <label for="signup-name" data-i18n="Username">Username</label>
      <input type="text" id="signup-name" placeholder="Choose your username" required>
    </div>
    <div class="form-group">
      <label for="signup-language" data-i18n="Language">Language</label>
      <select id="signup-language" required>
        <option value="English" selected data-i18n="English">English</option>
        <option value="French" data-i18n="French">FranÃ§ais</option>
        <option value="Korean" data-i18n="Korean">í•œêµ­ì–´</option>
      </select>
    </div>
    <div class="form-group">
      <label for="signup-email" data-i18n="Email">Email</label>
      <input type="email" id="signup-email" placeholder="Email" required>
    </div>
    <div class="form-group">
      <label for="signup-email-confirm" data-i18n="Confirm Email">Confirm Email</label>
      <input type="email" id="signup-email-confirm" placeholder="Confirm Email" required>
    </div>
    <div class="form-group">
      <label for="signup-password" data-i18n="Password">Password</label>
      <div style="position: relative;">
        <input type="password" id="signup-password" placeholder="Password" required>
        <button type="button" class="toggle-password" data-target="signup-password">ğŸ‘ï¸</button>
      </div>
    </div>
    <div class="form-group">
      <label for="signup-password-confirm" data-i18n="Confirm Password">Confirm Password</label>
      <div style="position: relative;">
        <input type="password" id="signup-password-confirm" placeholder="Confirm Password" required>
        <button type="button" class="toggle-password" data-target="signup-password-confirm">ğŸ‘ï¸</button>
      </div>
    </div>
    <button id="signup-button" data-i18n="Sign Up">Sign Up</button>
    <p id="error-message"></p>
  </div>

  <!-- Sign In Form -->
  <div id="signin-form">
    <h2 data-i18n="Sign In">Sign In</h2>
    <div class="form-group">
      <label for="signin-email" data-i18n="Email">Email</label>
      <input type="email" id="signin-email" placeholder="Email" required>
    </div>
    <div class="form-group">
      <label for="signin-password" data-i18n="Password">Password</label>
      <input type="password" id="signin-password" placeholder="Password" required>
    </div>
    <button id="signin-button" data-i18n="Sign In">Sign In</button>
    <p id="error-message"></p>
  </div>

  <div id="download-app-section" style="margin-top: 30px; text-align: center;">
    <button id="download-app-button" style="
      background-color: var(--estaco-accent);
      color: var(--estaco-text);
      border: none;
      border-radius: 8px;
      padding: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.3s;
      width: 100%;
    " data-i18n="Download the App">
      Download the App
    </button>
    <div id="install-guide" style="display: none; margin-top: 20px; text-align: left; background-color: var(--estaco-surface); padding: 20px; border-radius: 12px;">
      <h3 style="color: var(--estaco-primary);" data-i18n="How to Install the App">How to Install the App</h3>
      <p><strong data-i18n="Android">Android:</strong></p>
      <ol>
        <li data-i18n="Android step 1">Tap the <strong>three dots (â‹®)</strong> in the top-right corner of your browser.</li>
        <li data-i18n="Android step 2">Select <strong>"Add to Home screen"</strong>.</li>
        <li data-i18n="Android step 3">Tap <strong>"Add"</strong> to confirm.</li>
      </ol>
      <p><strong data-i18n="iPhone (iOS)">iPhone (iOS):</strong></p>
      <ol>
        <li data-i18n="iPhone step 1">Tap the <strong>Share button (â†‘)</strong> at the bottom of your screen.</li>
        <li data-i18n="iPhone step 2">Scroll down and select <strong>"Add to Home Screen"</strong>.</li>
        <li data-i18n="iPhone step 3">Tap <strong>"Add"</strong> to confirm.</li>
      </ol>
      <p style="font-size: 14px; color: var(--estaco-text-light);" data-i18n="App installed message">The app will now appear on your home screen like a normal app!</p>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-functions-compat.js"></script>
  <script>
    // Your Firebase config and JavaScript logic remain exactly the same
    const firebaseConfig = {
      apiKey: "AIzaSyB1txjASKb_6VPhKBpQh_Y3hoPHsNWwZ_0",
      authDomain: "estaco-add3c.firebaseapp.com",
      projectId: "estaco-add3c",
      storageBucket: "estaco-add3c.firebasestorage.app",
      messagingSenderId: "876337002297",
      appId: "1:876337002297:web:b410c373bd857bc7cd1ae8"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const functions = firebase.functions();

    // Rest of your JavaScript logic remains unchanged
    const showSignup = document.getElementById('show-signup');
    const showSignin = document.getElementById('show-signin');
    const signupForm = document.getElementById('signup-form');
    const signinForm = document.getElementById('signin-form');
    const signupButton = document.getElementById('signup-button');
    const signinButton = document.getElementById('signin-button');
    const errorMessage = document.getElementById('error-message');

    showSignup.addEventListener('click', () => {
      signupForm.style.display = 'block';
      signinForm.style.display = 'none';
    });

    showSignin.addEventListener('click', () => {
      signinForm.style.display = 'block';
      signupForm.style.display = 'none';
    });

    signupButton.addEventListener('click', () => {
      const name = document.getElementById('signup-name').value;
      const language = document.getElementById('signup-language').value;
      const email = document.getElementById('signup-email').value;
      const emailConfirm = document.getElementById('signup-email-confirm').value;
      const password = document.getElementById('signup-password').value;
      const passwordConfirm = document.getElementById('signup-password-confirm').value;
    
      // Validate inputs
      if (email !== emailConfirm) {
        errorMessage.textContent = translations[userLanguage]["Emails do not match."];
        return;
      }
      if (password !== passwordConfirm) {
        errorMessage.textContent = translations[userLanguage]["Passwords do not match."];
        return;
      }
      if (!isValidUsername(name)) {
        errorMessage.textContent = translations[userLanguage]["Username cannot contain spaces."];
        return;
      }
    
    // Check if the username already exists in the usernames collection
    db.collection('usernames')
      .where('name', '==', name)
      .get()
      .then((querySnapshot) => {
        if (!querySnapshot.empty) {
          errorMessage.textContent = translations[userLanguage]["Username is already taken."];
          return;
        }
    
        // If username is unique, proceed with sign-up
        auth.createUserWithEmailAndPassword(email, password)
          .then((userCredential) => {
            const user = userCredential.user;
            return user.updateProfile({ displayName: name });
          })
          .then(() => {
            const user = auth.currentUser;
            // Write to both users and usernames collections
            const userData = {
              name: name,
              language: language,
              email: email,
              profilePictureURL: null
            };
            return Promise.all([
              db.collection('users').doc(user.uid).set(userData),
              db.collection('usernames').doc(user.uid).set({ name: name })
            ]);
          })
          .then(() => {
            const user = auth.currentUser;
            return user.sendEmailVerification();
          })
          .then(() => {
            alert(translations[userLanguage]["Account created! Please check your email for a verification link."]);
            document.getElementById('signup-name').value = '';
            document.getElementById('signup-email').value = '';
            document.getElementById('signup-email-confirm').value = '';
            document.getElementById('signup-password').value = '';
            signupForm.style.display = 'none';
          })
          .catch((error) => {
            errorMessage.textContent = error.message;
          });
      })
      .catch((error) => {
        errorMessage.textContent = 'Error checking username: ' + error.message;
      });
    });

    signinButton.addEventListener('click', () => {
      const email = document.getElementById('signin-email').value;
      const password = document.getElementById('signin-password').value;
      const signinErrorMessage = document.querySelector('#signin-form #error-message');
    
      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          if (user.emailVerified) {
            alert(translations[userLanguage]["Signed in successfully!"]);
            window.location.href = 'home.html';
          } else {
            alert(translations[userLanguage]["Please verify your email before signing in. A verification link has been sent to your email address."]);
            auth.signOut();
          }
        })
        .catch((error) => {
          signinErrorMessage.textContent = error.message;
        });
    });

    function isValidUsername(username) {
      return !/\s/.test(username);
    }

    document.querySelectorAll('.toggle-password').forEach(button => {
      button.addEventListener('click', () => {
        const targetId = button.getAttribute('data-target');
        const passwordInput = document.getElementById(targetId);
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        button.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸';
      });
    });

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('ServiceWorker registration successful');
            // Force update check
            registration.update();
          })
          .catch((err) => {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }

    const downloadAppButton = document.getElementById('download-app-button');
    const installGuide = document.getElementById('install-guide');
    
    downloadAppButton.addEventListener('click', () => {
      if (installGuide.style.display === 'none') {
        installGuide.style.display = 'block';
        downloadAppButton.textContent = translations[userLanguage]["Hide Guide"];
      } else {
        installGuide.style.display = 'none';
        downloadAppButton.textContent = translations[userLanguage]["Download the App"];
      }
    });

    let userLanguage = "English"; // Define globally

    // Translations dictionary
    const translations = {
      English: {
        "Create Account": "Create Account",
        "Sign In": "Sign In",
        "Username": "Username",
        "Language": "Language",
        "Email": "Email",
        "Confirm Email": "Confirm Email",
        "Password": "Password",
        "Confirm Password": "Confirm Password",
        "Sign Up": "Sign Up",
        "Download the App": "Download the App",
        "How to Install the App": "How to Install the App",
        "Android": "Android:",
        "Android step 1": "Tap the <strong>three dots (â‹®)</strong> in the top-right corner of your browser.",
        "Android step 2": "Select <strong>\"Add to Home screen\"</strong>.",
        "Android step 3": "Tap <strong>\"Add\"</strong> to confirm.",
        "iPhone (iOS)": "iPhone (iOS):",
        "iPhone step 1": "Tap the <strong>Share button (â†‘)</strong> at the bottom of your screen.",
        "iPhone step 2": "Scroll down and select <strong>\"Add to Home Screen\"</strong>.",
        "iPhone step 3": "Tap <strong>\"Add\"</strong> to confirm.",
        "App installed message": "The app will now appear on your home screen like a normal app!",
        "Hide Guide": "Hide Guide",
        "Emails do not match.": "Emails do not match.",
        "Passwords do not match.": "Passwords do not match.",
        "Username cannot contain spaces.": "Username cannot contain spaces.",
        "Username is already taken.": "Username is already taken.",
        "Account created! Please check your email for a verification link.": "Account created! Please check your email for a verification link.",
        "Signed in successfully!": "Signed in successfully!",
        "Please verify your email before signing in. A verification link has been sent to your email address.": "Please verify your email before signing in. A verification link has been sent to your email address.",
        "Error checking username: ": "Error checking username: ",
      },
      French: {
        "Create Account": "CrÃ©er un compte",
        "Sign In": "Se connecter",
        "Username": "Nom d'utilisateur",
        "Language": "Langue",
        "Email": "Email",
        "Confirm Email": "Confirmer l'email",
        "Password": "Mot de passe",
        "Confirm Password": "Confirmer le mot de passe",
        "Sign Up": "S'inscrire",
        "Download the App": "TÃ©lÃ©charger l'application",
        "How to Install the App": "Comment installer l'application",
        "Android": "Android :",
        "Android step 1": "Appuyez sur les <strong>trois points (â‹®)</strong> dans le coin supÃ©rieur droit de votre navigateur.",
        "Android step 2": "SÃ©lectionnez <strong>\"Ajouter Ã  l'Ã©cran d'accueil\"</strong>.",
        "Android step 3": "Appuyez sur <strong>\"Ajouter\"</strong> pour confirmer.",
        "iPhone (iOS)": "iPhone (iOS) :",
        "iPhone step 1": "Appuyez sur le <strong>bouton Partager (â†‘)</strong> en bas de votre Ã©cran.",
        "iPhone step 2": "Faites dÃ©filer vers le bas et sÃ©lectionnez <strong>\"Ajouter Ã  l'Ã©cran d'accueil\"</strong>.",
        "iPhone step 3": "Appuyez sur <strong>\"Ajouter\"</strong> pour confirmer.",
        "App installed message": "L'application apparaÃ®tra dÃ©sormais sur votre Ã©cran d'accueil comme une application normale !",
        "Hide Guide": "Masquer le guide",
        "Emails do not match.": "Les emails ne correspondent pas.",
        "Passwords do not match.": "Les mots de passe ne correspondent pas.",
        "Username cannot contain spaces.": "Le nom d'utilisateur ne peut pas contenir d'espaces.",
        "Username is already taken.": "Ce nom d'utilisateur est dÃ©jÃ  pris.",
        "Account created! Please check your email for a verification link.": "Compte crÃ©Ã© ! Veuillez vÃ©rifier votre email pour le lien de vÃ©rification.",
        "Signed in successfully!": "Connexion rÃ©ussie !",
        "Please verify your email before signing in. A verification link has been sent to your email address.": "Veuillez vÃ©rifier votre email avant de vous connecter. Un lien de vÃ©rification a Ã©tÃ© envoyÃ© Ã  votre adresse email.",
        "Error checking username: ": "Erreur lors de la vÃ©rification du nom d'utilisateur : ",
      },
      Korean: {
        "Create Account": "ê³„ì • ë§Œë“¤ê¸°",
        "Sign In": "ë¡œê·¸ì¸",
        "Username": "ì‚¬ìš©ì ì´ë¦„",
        "Language": "ì–¸ì–´",
        "Email": "ì´ë©”ì¼",
        "Confirm Email": "ì´ë©”ì¼ í™•ì¸",
        "Password": "ë¹„ë°€ë²ˆí˜¸",
        "Confirm Password": "ë¹„ë°€ë²ˆí˜¸ í™•ì¸",
        "Sign Up": "ê°€ì…í•˜ê¸°",
        "Download the App": "ì•± ë‹¤ìš´ë¡œë“œ",
        "How to Install the App": "ì•± ì„¤ì¹˜ ë°©ë²•",
        "Android": "ì•ˆë“œë¡œì´ë“œ:",
        "Android step 1": "<strong>ì„¸ ì (â‹®)</strong>ì„ ë¸Œë¼ìš°ì € ì˜¤ë¥¸ìª½ ìƒë‹¨ ëª¨ì„œë¦¬ì— íƒ­í•˜ì„¸ìš”.",
        "Android step 2": "<strong>\"í™ˆ í™”ë©´ì— ì¶”ê°€\"</strong>ë¥¼ ì„ íƒí•˜ì„¸ìš”.",
        "Android step 3": "<strong>\"ì¶”ê°€\"</strong>ë¥¼ íƒ­í•˜ì—¬ í™•ì¸í•˜ì„¸ìš”.",
        "iPhone (iOS)": "ì•„ì´í° (iOS):",
        "iPhone step 1": "í™”ë©´ í•˜ë‹¨ì— ìˆëŠ” <strong>ê³µìœ  ë²„íŠ¼(â†‘)</strong>ì„ íƒ­í•˜ì„¸ìš”.",
        "iPhone step 2": "ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ <strong>\"í™ˆ í™”ë©´ì— ì¶”ê°€\"</strong>ë¥¼ ì„ íƒí•˜ì„¸ìš”.",
        "iPhone step 3": "<strong>\"ì¶”ê°€\"</strong>ë¥¼ íƒ­í•˜ì—¬ í™•ì¸í•˜ì„¸ìš”.",
        "App installed message": "ì´ì œ ì•±ì´ ì¼ë°˜ ì•±ì²˜ëŸ¼ í™ˆ í™”ë©´ì— í‘œì‹œë©ë‹ˆë‹¤!",
        "Hide Guide": "ê°€ì´ë“œ ìˆ¨ê¸°ê¸°",
        "Emails do not match.": "ì´ë©”ì¼ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
        "Passwords do not match.": "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
        "Username cannot contain spaces.": "ì‚¬ìš©ì ì´ë¦„ì— ê³µë°±ì„ í¬í•¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
        "Username is already taken.": "ì´ ì‚¬ìš©ì ì´ë¦„ì€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤.",
        "Account created! Please check your email for a verification link.": "ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ë©”ì¼ì—ì„œ í™•ì¸ ë§í¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.",
        "Signed in successfully!": "ë¡œê·¸ì¸ ì„±ê³µ!",
        "Please verify your email before signing in. A verification link has been sent to your email address.": "ë¡œê·¸ì¸ ì „ì— ì´ë©”ì¼ì„ í™•ì¸í•˜ì„¸ìš”. í™•ì¸ ë§í¬ê°€ ì´ë©”ì¼ ì£¼ì†Œë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.",
        "Error checking username: ": "ì‚¬ìš©ì ì´ë¦„ í™•ì¸ ì¤‘ ì˜¤ë¥˜: ",
      }
    };
    
    // Function to update the page language
    function updatePageLanguage(language) {
      const lang = translations[language] || translations["English"];
      document.querySelectorAll("[data-i18n]").forEach((element) => {
        const key = element.getAttribute("data-i18n");
        if (lang[key]) {
          element.textContent = lang[key];
        }
      });
    }

    const languageSelect = document.getElementById('language-select');
    languageSelect.addEventListener('change', (event) => {
      userLanguage = event.target.value;
      updatePageLanguage(userLanguage);
    });

    updatePageLanguage(userLanguage);
  </script>
</body>
</html>
